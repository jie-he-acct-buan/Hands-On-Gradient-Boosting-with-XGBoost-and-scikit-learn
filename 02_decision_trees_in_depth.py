import numpy as np
import pandas as pd
import sklearn.model_selection
pd.options.display.max_rows = 300
pd.options.display.max_columns = None
import sklearn
import xgboost
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')
import os
os.chdir('E:/Data_Science_Study/' + 
         'Hands-On Gradient Boosting with XGBoost and scikit-learn/')


# ----------------------------------------------------------------------------
# read the data generated in chapter 1 dataset 2
# ----------------------------------------------------------------------------
df_census = pd.read_csv('dataset_2_census/census_cleaned.csv')
df_census
df_census.dtypes


# ----------------------------------------------------------------------------
# define X and y
# ----------------------------------------------------------------------------
X = df_census.drop(['income_ >50K'], axis=1)
y = df_census['income_ >50K']

X_train, X_test = sklearn.model_selection.train_test_split(X, random_state=2)
y_train, y_test = sklearn.model_selection.train_test_split(y, random_state=2)


# ----------------------------------------------------------------------------
# build the model
# ----------------------------------------------------------------------------
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import accuracy_score

clf = DecisionTreeClassifier(random_state=2)
clf.fit(X_train, y_train)
y_pred = clf.predict(X_test)

accuracy = accuracy_score(y_pred, y_test)
print('The accuracy of the model is {:.2%}'.format(accuracy))


# ----------------------------------------------------------------------------
# tree visualization
# ----------------------------------------------------------------------------
from sklearn.tree import export_graphviz
import graphviz
os.environ['PATH'] += os.pathsep + 'C:/Program Files/Graphviz/bin'

dot_data = export_graphviz(clf,
                           max_depth=2,
                           feature_names=X.columns,
                           class_names=True,
                           filled=True,
                           rounded=True,
                           special_characters=True)

graph = graphviz.Source(dot_data)

graph.render('02_tree_1', format='png', cleanup=True)





















# ----------------------------------------------------------------------------

# now we are going to tune hyper-parameters

# ----------------------------------------------------------------------------
# ----------------------------------------------------------------------------
# read cleaned bike rentals data generated in chapter 1
# ----------------------------------------------------------------------------
df_bikes = pd.read_csv('dataset_1_bike_rentals/bike_rentals_cleaned.csv')
df_bikes.dtypes
df_bikes


X_bikes = df_bikes.drop(['cnt'], axis=1)
y_bikes = df_bikes['cnt']


# ----------------------------------------------------------------------------
# build a decition tree model
# ----------------------------------------------------------------------------
from sklearn.tree import DecisionTreeRegressor
from sklearn.model_selection import cross_val_score

reg = DecisionTreeRegressor(random_state=2)
scores = cross_val_score(reg, X_bikes, y_bikes, 
                         scoring='neg_root_mean_squared_error', cv=5)

print('RMSE of the model is {:.2f}'.format(-scores.mean()))


















# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------























# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------